<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add New Trading Account</title>
    <!-- Styles -->
    <link rel="stylesheet" href="/styles/user-set-credentials.css">
    <!-- Scripts -->
    <script src="/scripts/main-scripts/globalProvider.js"></script>
    <script src="/scripts/set-credentials.js"></script>
</head>
<body>
    <!-- Exchange Selection Screen -->
    <div class="form-container" id="exchange-selection-container">
        <h2>Select Your Exchange</h2>
        <div class="exchange-option-group">
            <!-- Bitget Option -->
            <div class="exchange-option" id="bitget-option">
                <img src="/images/other_images/bitget-img.jpg" alt="Bitget Logo" class="exchange-image">
                <div class="exchange-name">Bitget</div>
                <div class="exchange-description">Trade with Bitget securely and efficiently.</div>
            </div>
            
            <!-- Binance Option -->
            <div class="exchange-option" id="binance-option">
                <img src="/images/other_images/binance-img.png" alt="Binance Logo" class="exchange-image">
                <div class="exchange-name">Binance</div>
                <div class="exchange-description">Join Binance for a wide range of trading options.</div>
            </div>
        </div>
        <p class="label-description-b" style="margin-top: 20px;">Currently, we only support these exchanges, but we plan to add more in the future.</p>
    </div>
    

    <!-- Form Container -->
<div class="form-container" id="form-container" style="display:none;">
    <div class="exchange-heading">
        <h2 id="exchange-heading-text">Connect exchange</h2>
        <img src="/images/other_images/bitget-loco.svg" alt="Bitget Logo" id="bitget-image" class="exchange-logo" style="display:none;">
        <img src="/images/binance_logo.png" alt="Binance Logo" id="binance-image" class="exchange-logo" style="display:none;">
    </div>

    <!-- Back to exchange selection link -->
    <p class="label-description-b">
        <a href="#" id="back-to-exchange">‚Üê Back</a>
    </p>

    <form id="account-form">
        <div class="form-group">
                <label for="account_name">Account Name</label>
                <input type="text" id="account_name" name="account_name" required>
            </div>
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required>
            </div>
            <input type="hidden" id="exchange_selection" name="exchange_selection">

            <!-- Bitget Fields -->
            <div id="bitget-fields" style="display: none;">
                <div class="form-group">
                    <label for="bitget_api_key">Bitget API Key</label>
                    <input type="text" id="bitget_api_key" name="bitget_api_key">
                </div>
                <div class="form-group">
                    <label for="bitget_secret_key">Bitget Secret Key</label>
                    <input type="password" id="bitget_secret_key" name="bitget_secret_key">
                </div>
                <div class="form-group">
                    <label for="bitget_passphrase">Bitget Passphrase</label>
                    <input type="text" id="bitget_passphrase" name="bitget_passphrase">
                </div>

                <!-- Highlighted Section for Bitget Only -->
                <div class="bitget-set-ip">
                    <h5>
                        Connect keys securely
                        <a href="/full-guide" class="full-guide-link" target="_blank" rel="noopener noreferrer">
                            Full guide
                            <svg width="12px" height="12px" class="svg-icon" viewBox="0 0 16 16" fill="none">
                                <path fill="currentColor" d="M5.3333 0a.8889.8889 0 110 1.7778H1.7778v12.4444h12.4444v-3.5555a.8889.8889 0 111.7778 0v4.4444a.8889.8889 0 01-.8889.8889H.8889A.8888.8888 0 010 15.1111V.8889A.8889.8889 0 01.8889 0h4.4444zm7.632 1.7778H9.7778a.8889.8889 0 010-1.7778H16v6.2222a.889.889 0 01-1.7778 0V3.0347L8.6284 8.6284a.8887.8887 0 11-1.2568-1.2568l5.5937-5.5938z"></path>
                            </svg>
                        </a>
                    </h5>
                    <p>This is an additional highlighted section specific to your Bitget connection.</p>
                    <p>1. Step 1: Ensure your API keys are active.</p>
                    <p>2. Turn on IP whitelisting and copy/paste the following list of IP addresses:</p>
                    
                    <!-- Copy IP Section -->
                    <div class="copy-ip-container">
                        <span id="bitget-ip-label" class="ip-address">1.2.3.4</span>
                        <button type="button" class="copy-ip-button" aria-label="Copy IP Address">
                            <img src="/images/icons/copy.png" alt="Copy IP" class="copy-icon">
                        </button>
                        <span class="copy-tooltip" id="copy-tooltip">Copy IP</span>
                    </div>
                    
                    <p>3. Step 3: Confirm the connection.</p>
                </div>                
            </div>

            <!-- Binance Fields -->
            <div id="binance-fields" style="display: none;">
                <div class="form-group">
                    <label for="binance_api_key">Binance API Key</label>
                    <input type="text" id="binance_api_key" name="binance_api_key">
                </div>
                <div class="form-group">
                    <label for="binance_secret_key">Binance Secret Key</label>
                    <input type="password" id="binance_secret_key" name="binance_secret_key">
                </div>
            </div>

            <button type="submit" id="submit-button">
                Connect Exchange
                <img src="/images/lock.png" alt="Secure Submit" class="submit-lock-icon">
            </button>
            <div class="security-message">
                <img src="/images/lock.png" alt="Secure" class="lock-icon-small">
                <span>Your data is transmitted securely over HTTPS and will be securely encrypted</span>
            </div>
        </form>
    </div>


    <!-- Confirmation Screen -->
    <div id="confirmation-screen" style="display:none;">
        <div class="confirmation-container">
            <h3>IMPORTANT</h3>
            <h2>Have you added the IP <span id="ip-address-confirmation">Loading...</span>?</h2>
            <p class="label-description-b">Adding this IP address to your exchange account is essential. Without it, the application will not be able to connect securely.</p>
            <div class="button-group">
                <button id="yes-button" class="highlighted-button">YES</button>
                <button id="no-button">NO</button>
            </div>
        </div>
    </div>

    <!-- Success Screen -->
    <div id="success-screen" style="display:none;">
        <div class="confirmation-container">
            <h3>Success!</h3>
            <h2>Your account has been added successfully.</h2>
            <div class="button-group">
                <button id="ok-button" class="highlighted-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Error Screen -->
    <div id="error-screen" style="display:none;">
        <div class="confirmation-container">
            <h3>Error</h3>
            <h2>Failed to add your account. Please check your credentials and try again.</h2>
            <div class="button-group">
                <button id="retry-button" class="highlighted-button">Retry</button>
            </div>
        </div>
    </div>

    <!-- Loading Bar Container -->
    <div class="loading-container" id="loading-bar" style="display: none;">
        <div class="loading-bar"></div>
    </div>

    <script>
        let currentExchange = null;

        document.addEventListener('DOMContentLoaded', function() {
            const exchangeSelectionContainer = document.getElementById('exchange-selection-container');
            const formContainer = document.getElementById('form-container');

            const bitgetOption = document.getElementById('bitget-option');
            const binanceOption = document.getElementById('binance-option');

            const exchangeSelectionInput = document.getElementById('exchange_selection');
            const bitgetFields = document.getElementById('bitget-fields');
            const binanceFields = document.getElementById('binance-fields');

            const exchangeHeadingText = document.getElementById('exchange-heading-text');
            const bitgetImage = document.getElementById('bitget-image');
            const binanceImage = document.getElementById('binance-image');

            const backToExchangeLink = document.getElementById('back-to-exchange');
            const accountForm = document.getElementById('account-form');
            const submitButton = document.getElementById('submit-button');

            const confirmationScreen = document.getElementById('confirmation-screen');
            const yesButton = document.getElementById('yes-button');
            const noButton = document.getElementById('no-button');

            const loadingBar = document.getElementById('loading-bar');
            const successScreen = document.getElementById('success-screen');
            const errorScreen = document.getElementById('error-screen');
            const okButton = document.getElementById('ok-button');
            const retryButton = document.getElementById('retry-button');

            const ipAddressMain = document.getElementById('ip-address-main');
            const ipAddressConfirmation = document.getElementById('ip-address-confirmation');
            const ipDisplay = document.getElementById('ip-display');

            const copyContainer = document.querySelector('.copy-container');
            const tooltip = document.querySelector('.tooltip');

            // Back to exchange selection link
            backToExchangeLink.addEventListener('click', function(e) {
                e.preventDefault();
                // Hide form, show selection
                formContainer.style.display = 'none';
                exchangeSelectionContainer.style.display = 'block';

                // Reset fields
                bitgetFields.style.display = 'none';
                binanceFields.style.display = 'none';
                if (ipDisplay) ipDisplay.style.display = 'none';
                exchangeSelectionInput.value = '';

                // Reset heading and images
                exchangeHeadingText.textContent = "Connect exchange";
                bitgetImage.style.display = 'none';
                binanceImage.style.display = 'none';
                submitButton.innerHTML = 'Connect Exchange <img src="/images/lock.png" alt="Secure Submit" class="submit-lock-icon">';
            });

            // Exchange selection: Bitget
            bitgetOption.addEventListener('click', function() {
                currentExchange = 'bitget';
                exchangeSelectionInput.value = 'bitget';

                // Show Bitget fields, hide Binance fields
                bitgetFields.style.display = 'block';
                binanceFields.style.display = 'none';

                // Hide selection, show form
                exchangeSelectionContainer.style.display = 'none';
                formContainer.style.display = 'block';

                if (ipDisplay) ipDisplay.style.display = 'block';

                // Update heading and images for Bitget
                exchangeHeadingText.textContent = "Connect exchange"; // Keep the text unchanged
                bitgetImage.style.display = 'inline-block';
                binanceImage.style.display = 'none';
                submitButton.innerHTML = 'Connect Bitget <img src="/images/lock.png" alt="Secure Submit" class="submit-lock-icon">';

                // Set the IP address
                if (ipAddressMain && ipAddressConfirmation) {
                    ipAddressMain.textContent = "1.2.3.4"; // Replace with actual IP if available
                    ipAddressConfirmation.textContent = "1.2.3.4";
                }
            });

            // Exchange selection: Binance
            binanceOption.addEventListener('click', function() {
                currentExchange = 'binance';
                exchangeSelectionInput.value = 'binance';

                // Show Binance fields, hide Bitget fields
                binanceFields.style.display = 'block';
                bitgetFields.style.display = 'none';

                // Hide selection, show form
                exchangeSelectionContainer.style.display = 'none';
                formContainer.style.display = 'block';

                if (ipDisplay) ipDisplay.style.display = 'block';

                // Update heading and images for Binance
                exchangeHeadingText.textContent = "Connect exchange"; // Keep the text unchanged
                binanceImage.style.display = 'inline-block';
                bitgetImage.style.display = 'none';
                submitButton.innerHTML = 'Connect Binance <img src="/images/lock.png" alt="Secure Submit" class="submit-lock-icon">';

                // Set the IP address (if needed for Binance)
                if (ipAddressMain && ipAddressConfirmation) {
                    ipAddressMain.textContent = "1.2.3.4"; // Replace with actual IP if available
                    ipAddressConfirmation.textContent = "1.2.3.4";
                }
            });

            // COPY SECTION
            document.addEventListener('DOMContentLoaded', function() {
                const copyButton = document.querySelector('.copy-ip-button');
                const copyTooltip = document.getElementById('copy-tooltip');
                const ipAddressElement = document.getElementById('bitget-ip-label');

                // Function to copy IP address to clipboard
                async function copyIP() {
                    const ipAddress = ipAddressElement.textContent.trim();
                    if (!ipAddress) {
                        copyTooltip.textContent = "No IP to copy!";
                        showTooltip();
                        return;
                    }
                    try {
                        await navigator.clipboard.writeText(ipAddress);
                        copyTooltip.textContent = "Copied!";
                    } catch (err) {
                        copyTooltip.textContent = "Failed to copy!";
                    }
                    showTooltip();
                }

                // Function to show tooltip
                function showTooltip() {
                    copyButton.classList.add('show-tooltip');
                    setTimeout(() => {
                        copyButton.classList.remove('show-tooltip');
                        copyTooltip.textContent = "Copy IP"; // Reset tooltip text
                    }, 2000);
                }

                // Event listener for copy button click
                copyButton.addEventListener('click', copyIP);

                // Accessibility: Allow copying via keyboard (Enter or Space)
                copyButton.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        copyIP();
                    }
                });
            });

            // Form submission and other event listeners remain unchanged...
            accountForm.addEventListener('submit', function(e) {
                e.preventDefault();
                confirmationScreen.style.display = 'flex';
            });

            yesButton.addEventListener('click', function() {
                confirmationScreen.style.display = 'none';
                loadingBar.style.display = 'block';

                // Simulate API call
                setTimeout(() => {
                    loadingBar.style.display = 'none';
                    const success = true; // Change this to false to simulate failure
                    if (success) {
                        successScreen.style.display = 'flex';
                    } else {
                        errorScreen.style.display = 'flex';
                    }
                }, 1000);
            });

            noButton.addEventListener('click', function() {
                confirmationScreen.style.display = 'none';
            });

            okButton.addEventListener('click', function() {
                successScreen.style.display = 'none';
                window.location.reload();
            });

            retryButton.addEventListener('click', function() {
                errorScreen.style.display = 'none';
            });
        });


    </script>
</body>
</html>
